<style>
  input:not([type="radio"]),
  button {
    display: block;
  }
</style>

<h2>Linkma</h2>
<form>
  <fieldset>
    <legend>Enter your fake user information</legend>
    <label for="username">Username</label>
    <input id="username" type="text" value="@galloanna" />

    <label for="name">Name</label>
    <input id="name" type="text" value="Anna Gallo" />

    <img
      id="thumbnail-preview"
      alt=""
      src="https://i.imgur.com/AoYvA0H.png"
      width="40px"
      height="40px"
    />
    <label for="avatar">User Photo URL</label>
    <input id="avatar" type="text" value="https://i.imgur.com/AoYvA0H.png" />

    <label for="content">Post Content</label>
    <input
      class="textarea"
      id="content"
      type="textarea"
      value="Thinks Design Systems are the bees knees. ðŸ"
    />

    <button id="randomize-user">Randomize</button>
  </fieldset>

  <fieldset>
    <legend>Choose design options</legend>

    <label class="switch__label" for="dark-mode-on">Dark mode</label>
    <input type="checkbox" id="dark-mode-on" />

    <label for="no-image">No Image</label>
    <input
      type="radio"
      id="no-image"
      name="postImageVariants"
      value="no-image"
      checked
    />

    <label for="image">Image</label>
    <input type="radio" id="image" name="postImageVariants" value="image" />
  </fieldset>
  <button id="generate-post">Generate Post</button>
  <button id="close">Close</button>
</form>

<script>
  document.getElementById("randomize-user").onclick = (e) => {
    e.preventDefault();
    async function fetchFakeUser() {
      const response = await fetch("https://randomuser.me/api/");
      const userData = await response.json();
      return userData;
    }
    fetchFakeUser().then((userData) => {
      const data = userData.results[0];
      console.log("data ", data);
      document.getElementById("name").value =
        data.name.first + " " + data.name.last;
      document.getElementById("username").value = "@" + data.login.username;
      document.getElementById("avatar").value = data.picture.thumbnail;
      document.getElementById("thumbnail-preview").src = data.picture.thumbnail;
    });
  };

  document.getElementById("generate-post").onclick = (e) => {
    e.preventDefault();
    const name = document.getElementById("name").value;
    const username = document.getElementById("username").value;
    const avatar = document.getElementById("avatar").value;
    const content = document.getElementById("content").value;
    const darkModeState = document.getElementById("dark-mode-on").checked;
    const imageVariant = document.querySelector(
      'input[name="postImageVariants"]:checked'
    ).value;

    parent.postMessage(
      {
        pluginMessage: {
          type: "generate-post",
          name,
          username,
          avatar,
          content,
          darkModeState,
          imageVariant,
        },
      },
      "*"
    );
  };
  document.getElementById("close").onclick = () => {
    parent.postMessage({ pluginMessage: { type: "close" } }, "*");
  };
</script>
